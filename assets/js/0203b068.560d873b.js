"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1642],{5680:(e,t,n)=>{n.d(t,{xA:()=>c,yg:()=>y});var o=n(6540);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=o.createContext({}),s=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=s(e.components);return o.createElement(p.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=s(n),h=a,y=d["".concat(p,".").concat(h)]||d[h]||u[h]||r;return n?o.createElement(y,i(i({ref:t},c),{},{components:n})):o.createElement(y,i({ref:t},c))}));function y(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=h;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[d]="string"==typeof e?e:a,i[1]=l;for(var s=2;s<r;s++)i[s]=n[s];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},9286:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var o=n(8168),a=(n(6540),n(5680));const r={sidebar_position:4},i="Deploy example",l={unversionedId:"high_assurance/deploy",id:"high_assurance/deploy",title:"Deploy example",description:"In this section, we will deploy the Banking application.",source:"@site/docs/high_assurance/deploy.md",sourceDirName:"high_assurance",slug:"/high_assurance/deploy",permalink:"/passkey-workshop/docs/high_assurance/deploy",draft:!1,editUrl:"https://github.com/YubicoLabs/passkey-workshop/tree/main/docs/docs/high_assurance/deploy.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Architecture",permalink:"/passkey-workshop/docs/high_assurance/architecture"},next:{title:"Relying party",permalink:"/passkey-workshop/docs/category/relying-party-1"}},p={},s=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Deployment configurations",id:"deployment-configurations",level:2},{value:"Deploying the project",id:"deploying-the-project",level:2},{value:"Running the mobile client",id:"running-the-mobile-client",level:2}],c={toc:s},d="wrapper";function u(e){let{components:t,...n}=e;return(0,a.yg)(d,(0,o.A)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"deploy-example"},"Deploy example"),(0,a.yg)("p",null,"In this section, we will deploy the Banking application.\nIt uses the same script that was used to ",(0,a.yg)("a",{parentName:"p",href:"/docs/deploy"},"deploy the demo application"),", but here we need to configure the application a little differently."),(0,a.yg)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.yg)("p",null,"As before, we need ",(0,a.yg)("a",{parentName:"p",href:"https://www.docker.com/"},"Docker")," to deploy the environment locally.\nBut to use the banking application with high assurance, a FIDO2 security key like a YubiKey is required.\nWe assume you already cloned the repository."),(0,a.yg)("h2",{id:"deployment-configurations"},"Deployment configurations"),(0,a.yg)("p",null,"The file ",(0,a.yg)("inlineCode",{parentName:"p"},".env")," will need to be edited for the specific parameters for use in the banking application."),(0,a.yg)("p",null,"Here is an example configuration with settings relevant to the banking API (other settings can be left intact)"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"# Client applications to deploy\nDEPLOYMENT_CLIENTS=bank\n\n# Domain that identifies the relying party\n# Reference: https://www.w3.org/TR/webauthn-2/#relying-party-identifier\nRP_ID=localhost\n\n# Human readable name that relates to the name of the site listed from the RP_ID\nRP_NAME=PKBank\n\n...\n\n# Allow registrations that don't include some form of trusted attestation\nRP_ALLOW_UNTRUSTED_ATTESTATION=true\n\n# Leverage attestation through the FIDO Metadata Service (MDS)\nRP_ATTESTATION_TRUST_STORE=mds\n\n# Allowed origins for java-app\n# Denotes the origins that can generate a credential that will be accepted by the relying party.\n# This should closely correspond to the domain denoted in the RP_ID. \n# Note that unlike the RP_ID, this value will require the port number.\nRP_ALLOWED_ORIGINS=localhost:8081,localhost:3002\n\n# Spring-Boot framework config for allowed cross-origins domains (CORS)\n# shared between java-app and bank-app\nRP_ALLOWED_CROSS_ORIGINS=localhost:8081,localhost:3002\n\n# Allowed authenticators, referenced by AAGUID. Leave empty to allow any authenticator\nALLOW_LIST_AAGUIDS=73bb0cd4-e502-49b8-9c6f-b59445bf720b,85203421-48f9-4355-9bc8-8a53846e5083,c1f9a0bc-1dd2-404a-b27f-8e29047a43fd\n\n...\n\n# Location of the Bank client\nBANK_CLIENT_URL=http://localhost:3002\n# Location of the the RP API keycloak can connect to for passkey registration/validation\n# Note that this is a backend call so connect to the docker host when deploying on localhost\nRP_API=http://host.docker.internal:8080/v1\n\n\n# bank-react-app HA client configuration\nREACT_APP_BANK_API=http://localhost:8082/v1\nREACT_APP_KEYCLOAK_URL=http://localhost:8081\nREACT_APP_CLIENT_ID=BankApp\n")),(0,a.yg)("p",null,"Note the differences with the demo application. In particular:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"The banking web client is deployed on localhost:3002"),(0,a.yg)("li",{parentName:"ul"},"The banking API is deployed on localhost:8082"),(0,a.yg)("li",{parentName:"ul"},"Origin settings have been updated accordingly"),(0,a.yg)("li",{parentName:"ul"},"The setting for ",(0,a.yg)("inlineCode",{parentName:"li"},"ALLOW_LIST_AAGUIDS")," has now been set. The AAGUIDS are for the YubiKey 5 Series, but you can change that to match your specific make and model or leave it blank to accept any authenticator.")),(0,a.yg)("h2",{id:"deploying-the-project"},"Deploying the project"),(0,a.yg)("p",null,"As before, use the deploy scripts (",(0,a.yg)("inlineCode",{parentName:"p"},"deploy.sh")," or ",(0,a.yg)("inlineCode",{parentName:"p"},"deploy.ps1"),") to deploy the application."),(0,a.yg)("p",null,"To stop, start, or remove the project, use docker compose:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"docker compose stop\ndocker compose start\ndocker compose down\n")),(0,a.yg)("h2",{id:"running-the-mobile-client"},"Running the mobile client"),(0,a.yg)("p",null,"The workshop repository also includes an iOS native app.\nBecause this app is run on a separate device, you will need to deploy the server components using devtunnel in order for your iOS device to be able to communicate with those components."),(0,a.yg)("p",null,"Deploying with devtunnel works the same as before. Edit your ",(0,a.yg)("inlineCode",{parentName:"p"},".env")," file and include the following variable:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"DEPLOYMENT_ENVIRONMENT=devtunnel\n")),(0,a.yg)("p",null,"Then run the deploy scripts (",(0,a.yg)("inlineCode",{parentName:"p"},"deploy.sh")," or ",(0,a.yg)("inlineCode",{parentName:"p"},"deploy.ps1"),") again."),(0,a.yg)("p",null,"The deploy script will launch your devtunnel and edit the iOS sources to point to your tunneled endpoints."),(0,a.yg)("p",null,"With that, you should be able to compile and run the mobile client as follows:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"Change directory to ",(0,a.yg)("inlineCode",{parentName:"li"},"examples/clients/mobile/iOS/PKBank"),"."),(0,a.yg)("li",{parentName:"ol"},"Launch project ",(0,a.yg)("inlineCode",{parentName:"li"},"PKBank.xcodeproj")," in Xcode."),(0,a.yg)("li",{parentName:"ol"},"Build and Run the project on your iOS device.")))}u.isMDXComponent=!0}}]);