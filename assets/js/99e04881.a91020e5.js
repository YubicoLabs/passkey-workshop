"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7595],{7235:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"deploy","title":"Deploy project","description":"In this section we are going to deploy the project to your local environment. At the end of this section you should be able to access all of the components that will allow you to test, and further understand the workings of a passkey application.","source":"@site/docs/deploy.md","sourceDirName":".","slug":"/deploy","permalink":"/passkey-workshop/docs/deploy","draft":false,"unlisted":false,"editUrl":"https://github.com/YubicoLabs/passkey-workshop/tree/main/docs/docs/deploy.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Relying party","permalink":"/passkey-workshop/docs/architecture/relying-party"},"next":{"title":"Relying Party","permalink":"/passkey-workshop/docs/category/relying-party"}}');var i=o(2467),s=o(8453);const r={sidebar_position:4},l="Deploy project",a={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Clone the repository",id:"clone-the-repository",level:2},{value:"Deployment configurations",id:"deployment-configurations",level:2},{value:"Deploying the project",id:"deploying-the-project",level:2},{value:"Deploying a native iOS example",id:"deploying-a-native-ios-example",level:3},{value:"Stopping the project",id:"stopping-the-project",level:2},{value:"Removing the project",id:"removing-the-project",level:2},{value:"Docker container disappearing",id:"docker-container-disappearing",level:2},{value:"Docker Desktop",id:"docker-desktop",level:3},{value:"Podman",id:"podman",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"deploy-project",children:"Deploy project"})}),"\n",(0,i.jsx)(n.p,{children:"In this section we are going to deploy the project to your local environment. At the end of this section you should be able to access all of the components that will allow you to test, and further understand the workings of a passkey application."}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"The following prerequisite items are required in order to run, and test this application in your local environment."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.docker.com/",children:"Docker"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://git-scm.com/",children:"Git"})}),"\n",(0,i.jsxs)(n.li,{children:["FIDO2 authenticator","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A security key, like a Yubikey"}),"\n",(0,i.jsx)(n.li,{children:"A device with a platform authenticator such as TouchID/FaceID, or Windows Hello"}),"\n",(0,i.jsxs)(n.li,{children:["A browser that supports virtual authenticators, such as ",(0,i.jsx)(n.a,{href:"https://developer.chrome.com/docs/devtools/webauthn/",children:"Google Chrome"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["A platform (browser and operating system) that supports WebAuthn/passkeys (",(0,i.jsx)(n.a,{href:"https://passkeys.dev/device-support/",children:"browser support matrix"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"clone-the-repository",children:"Clone the repository"}),"\n",(0,i.jsx)(n.p,{children:"Your first step will be to clone the repository from GitHub, using git."}),"\n",(0,i.jsx)(n.p,{children:"With HTTPS"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/YubicoLabs/passkey-workshop.git\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Once the repository is cloned, navigate into the ",(0,i.jsx)(n.code,{children:"deploy"})," folder."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd passkey-workshop/deploy\n"})}),"\n",(0,i.jsx)(n.h2,{id:"deployment-configurations",children:"Deployment configurations"}),"\n",(0,i.jsxs)(n.p,{children:["The file ",(0,i.jsx)(n.code,{children:".env"})," will allow you to set specific parameters for use in the application.\nYou will need to create that file first, but there is an example file ",(0,i.jsx)(n.code,{children:"default.env"})," with defaults for a deployment to localhost."]}),"\n",(0,i.jsx)(n.admonition,{title:"Ensure you understand the configurations before changing them",type:"danger",children:(0,i.jsx)(n.p,{children:"If this is your first time deploying this application, or you are unfamiliar with passkeys, then we recommend that you utilize the default settings."})}),"\n",(0,i.jsxs)(n.p,{children:["Below is an overview of the configurations file, along with the default parameters.\nThe file ",(0,i.jsx)(n.code,{children:"default.env"})," contains comments with alternative settings for some configuration parameters."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"DEPLOYMENT_ENVIRONMENT=localhost\n\n# Client applications to deploy\nDEPLOYMENT_CLIENTS=demo\n\n# Domain that identifies the relying party\n# Reference: https://www.w3.org/TR/webauthn-2/#relying-party-identifier\nRP_ID=localhost\n\n# Human readable name that relates to the name of the site listed from the RP_ID\nRP_NAME=Workshop\n\n# Set the webauthn applications attestation preference\n# Reference: https://www.w3.org/TR/webauthn-2/#enumdef-attestationconveyancepreference\nRP_ATTESTATION_PREFERENCE=DIRECT\n\n# Allow registrations that don't include some form of trusted attestation\nRP_ALLOW_UNTRUSTED_ATTESTATION=true\n\n# Leverage attestation through the FIDO Metadata Service (MDS)\nRP_ATTESTATION_TRUST_STORE=mds\n\n# Allowed origins for java-app\nRP_ALLOWED_ORIGINS=localhost:8081,localhost:3000\n\n# Spring-Boot framework config for allowed cross-origins domains (CORS)\n# shared between java-app and bank-app\nRP_ALLOWED_CROSS_ORIGINS=localhost:8081,localhost:3000\n\n# Allowed authenticators, referenced by AAGUID. Leave empty to allow any authenticator\nALLOW_LIST_AAGUIDS=\n\n# database shared with java-app and bank-api\nDATABASE_TYPE=mysql\n# root password when using mysql\nDATABASE_PASSWORD=somegobbledygookhere\n\n# Location of the demo client\nDEMO_CLIENT_URL=http://localhost:3000\n\n# Location of the the RP API keycloak can connect to for passkey registration/validation\nRP_API=http://host.docker.internal:8080/v1\n\n# react-app demo client configuration\nREACT_APP_RP_API=http://localhost:8080/v1\nREACT_APP_OIDC=http://localhost:8081/realms/passkeyDemo/protocol/openid-connect\nREACT_APP_REDIRECT_URI=http://localhost:3000/oidc/callback\n"})}),"\n",(0,i.jsx)(n.h2,{id:"deploying-the-project",children:"Deploying the project"}),"\n",(0,i.jsx)(n.p,{children:"The default configuration will deploy the demo application on localhost.\nThis means the application can be accessed using a web browser running on the same system.\nLater, we will also look at a client running on your mobile device."}),"\n",(0,i.jsx)(n.p,{children:"To deploy the application, run the following command:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"For Mac-Linux"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./deploy.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"For Windows"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"\\deploy.ps1\n"})}),"\n",(0,i.jsx)(n.p,{children:"These scripts use docker compose to build all components and run them in containers."}),"\n",(0,i.jsxs)(n.p,{children:['As noted in the previous section, all "arguments" come in the form of the configurations set in the ',(0,i.jsx)(n.code,{children:".env"})," file."]}),"\n",(0,i.jsx)(n.p,{children:"Note: these scripts are used for both deploying a fresh version of the application, and for restarting the service if it has been stopped."}),"\n",(0,i.jsx)(n.p,{children:"Once the application has been deployed, your resources will be available through the following URLs"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Java-app (relying party) - ",(0,i.jsx)(n.a,{href:"http://localhost:8080",children:"http://localhost:8080"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Navigating to this resource will bring you to the API documentation"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Keycloak (identity and authorization provider) - ",(0,i.jsx)(n.a,{href:"http://localhost:8081",children:"http://localhost:8081"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Navigating to this resource will bring you to the Keycloak administrator screen"}),"\n",(0,i.jsxs)(n.li,{children:["The default credentials for the admin account is:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Username: admin"}),"\n",(0,i.jsx)(n.li,{children:"Password: admin"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["MySQL server (database) - ",(0,i.jsx)(n.a,{href:"http://localhost:3306",children:"http://localhost:3306"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"You won't be able to directly navigate to this resource. Please use a MySQL client to connect to the database"}),"\n",(0,i.jsxs)(n.li,{children:["The default credentials for the root account is:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Username: root"}),"\n",(0,i.jsxs)(n.li,{children:["Password: somegobbledygookhere (see the value of ",(0,i.jsx)(n.code,{children:"DATABASE_PASSWORD"})," in the ",(0,i.jsx)(n.code,{children:".env"})," file)"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["React-app (web client) - ",(0,i.jsx)(n.a,{href:"http://localhost:3000",children:"http://localhost:3000"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Navigating to this resource will bring you to the web client application"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"deploying-a-native-ios-example",children:"Deploying a native iOS example"}),"\n",(0,i.jsxs)(n.p,{children:["Follow the specific instructions found in the ",(0,i.jsx)(n.a,{href:"/docs/mobile-client/getting-started",children:"mobile-client: getting started"})," section."]}),"\n",(0,i.jsx)(n.h2,{id:"stopping-the-project",children:"Stopping the project"}),"\n",(0,i.jsx)(n.p,{children:"To stop the application containers, run the following command:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"For Mac-Linux"})," or ",(0,i.jsx)(n.strong,{children:"Windows"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker compose stop\n"})}),"\n",(0,i.jsx)(n.p,{children:"This will look for any instance of the containers set by our deploy script, and stop them from running."}),"\n",(0,i.jsx)(n.p,{children:"To start all containers again, use:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker compose start\n"})}),"\n",(0,i.jsx)(n.h2,{id:"removing-the-project",children:"Removing the project"}),"\n",(0,i.jsx)(n.p,{children:"To remove the application containers, run the following command:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"For Mac-Linux"})," or ",(0,i.jsx)(n.strong,{children:"Windows"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker compose down\n"})}),"\n",(0,i.jsx)(n.p,{children:"This will look for any instance of the containers and images set by our deploy script, and remove them from Docker instance."}),"\n",(0,i.jsx)(n.p,{children:'Once the application has been removed, you will need to run the deploy application script, where you will be given a fresh, "factory-default", version of the application.\nAny passkeys registered to the old deployment will be unusable.'}),"\n",(0,i.jsx)(n.h1,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.p,{children:"This section covers commmon issues while deploying."}),"\n",(0,i.jsx)(n.h2,{id:"docker-container-disappearing",children:"Docker container disappearing"}),"\n",(0,i.jsx)(n.p,{children:"In case some containers keep disappearing, or you see request timeouts connected to the JDBC, please ensure that you got enough memory allocated to your virtual machine running the docker containers."}),"\n",(0,i.jsx)(n.h3,{id:"docker-desktop",children:"Docker Desktop"}),"\n",(0,i.jsx)(n.p,{children:"If you run docker desktop, please open the settings and change the memory limit."}),"\n",(0,i.jsx)(n.h3,{id:"podman",children:"Podman"}),"\n",(0,i.jsxs)(n.p,{children:["If you use ",(0,i.jsx)(n.code,{children:"podman"})," with ",(0,i.jsx)(n.code,{children:"qemu"}),", please use the following commands to increase the memory size:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"podman machine stop\npodman machine set --memory 4096\npodman machine start\n"})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>l});var t=o(6540);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);