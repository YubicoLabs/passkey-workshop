"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[97],{1099:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>h});var a=n(7462),i=(n(7294),n(3905)),s=n(2004);const r={sidebar_position:3},o="Registration flows",l={unversionedId:"web-client/reg-flow",id:"web-client/reg-flow",title:"Registration flows",description:"This section will cover the registration flow for a new passkey. Note that the use of the term registration refers to the creation of a passkey, not the initial registration of a user (which is an entirely different subject).",source:"@site/docs/web-client/reg-flow.mdx",sourceDirName:"web-client",slug:"/web-client/reg-flow",permalink:"/docs/web-client/reg-flow",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/web-client/reg-flow.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"API client",permalink:"/docs/web-client/api-client"},next:{title:"Authentication flows",permalink:"/docs/web-client/auth-flow"}},c={},h=[{value:"Flow overview",id:"flow-overview",level:2},{value:"Event handler",id:"event-handler",level:2},{value:"User interface elements",id:"user-interface-elements",level:2}],u={toc:h},d="wrapper";function p(e){let{components:t,...r}=e;return(0,i.kt)(d,(0,a.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"registration-flows"},"Registration flows"),(0,i.kt)("p",null,"This section will cover the registration flow for a new passkey. Note that the use of the term registration refers to the creation of a passkey, not the initial registration of a user (which is an entirely different subject)."),(0,i.kt)("p",null,"By the end of this section you will understand how to use both of the ",(0,i.kt)("inlineCode",{parentName:"p"},"/attestation/options")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"/attestation/result")," methods (as defined by our ",(0,i.kt)("a",{parentName:"p",href:"relying-party/api-def"},"API"),") to implement a webpage that allows a user to create a passkey."),(0,i.kt)("h2",{id:"flow-overview"},"Flow overview"),(0,i.kt)("p",null,"The diagram below demonstrates how the relying party works with the client, and authenticator to register a new passkey. When interacting with the relying party, the client will leverage both of the ",(0,i.kt)("inlineCode",{parentName:"p"},"/attestation")," methods."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Passkey registration flow",src:n(5549).Z,width:"1095",height:"973"})),(0,i.kt)("p",null,"The first call (",(0,i.kt)("a",{parentName:"p",href:"http://localhost:8080/swagger-ui/index.html#/v1/serverPublicKeyCredentialCreationOptionsRequest"},(0,i.kt)("inlineCode",{parentName:"a"},"/attestation/options")),") is used to receive an object that includes the options/configurations that should be used when creating a new credential."),(0,i.kt)("p",null,"The second call (",(0,i.kt)("a",{parentName:"p",href:"http://localhost:8080/swagger-ui/index.html#/v1/serverAuthenticatorAttestationResponse"},(0,i.kt)("inlineCode",{parentName:"a"},"/attestation/result")),") is used to send the newly created passkey to be stored in the relying party."),(0,i.kt)("p",null,"The video below will demonstrate the registration flow implemented on this page."),(0,i.kt)(s.Z,{controls:!0,width:"75%",height:"75%",url:"/videos/reg-sec-key.mp4",style:{marginBottom:"2em"},mdxType:"ReactPlayer"}),(0,i.kt)("h2",{id:"event-handler"},"Event handler"),(0,i.kt)("p",null,"The method below will be used to facilitate the passkey registration ceremony. Note that this method will utilize the methods that were defined in the previous section on the ",(0,i.kt)("a",{parentName:"p",href:"/docs/web-client/api-client"},"API client"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'/**\n * The API client described in the previous section\n */\nimport PasskeyServices from "../../services/PasskeyServices";\nimport { create } from "@github/webauthn-json";\n\nconst [username, setUsername] = useState("");\n\nconst addNewPasskey = async (e) => {\n  try {\n    e.preventDefault();\n\n    /**\n     * Assume the username was set by a global variable\n     * when the user authenticated into their account\n     */\n    const attestationOptions = await PasskeyServices.getAttestationOptions(\n      username\n    );\n\n    /**\n     * This method is typically referred to as\n     * `navigator.credentials.create` but we are\n     * leveraging the @github/webauthn-json package\n     * to help with readability and encoding\n     */\n    const makeCredentialResult = await create(attestationOptions);\n\n    const credentialCreateResult = await PasskeyServices.sendAttestationResult(\n      attestationOptions.requestId,\n      makeCredentialResult\n    );\n\n    if (credentialCreateResult.status === "created") {\n      /**\n       * Do something\n       */\n    } else {\n      throw new Error("Error with creating result");\n    }\n  } catch (e) {\n    throw new Error("Error with creating result");\n  }\n};\n')),(0,i.kt)("h2",{id:"user-interface-elements"},"User interface elements"),(0,i.kt)("p",null,"The user interface items for passkey registration is fairly simple; it's just a single button!"),(0,i.kt)("p",null,"The user will click this button to begin the registration ceremony. The button will trigger an 'onClick' event that will handle the registration ceremony."),(0,i.kt)("p",null,"Note the exclusion of a username field. In our example the username is assumed from the user that is currently authenticated into the service, using an OpenID Connect token."),(0,i.kt)("p",null,"Below is an example of the button that can be used to trigger the registration ceremony."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<button onClick="{addNewPasskey}">Add a new passkey</button>\n')))}p.isMDXComponent=!0},5549:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/reg-flow-52108fe982668732c0a0c1f5b723eefc.jpg"}}]);